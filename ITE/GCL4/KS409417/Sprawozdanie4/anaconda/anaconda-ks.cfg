# Generated by Anaconda 40.22.3
# Generated by pykickstart v3.52
#version=DEVEL
# Use graphical install
graphical

# Keyboard layouts
keyboard --vckeymap=pl --xlayouts='pl'
# System language
lang pl_PL.UTF-8

%packages
@^server-product-environment
moby-engine
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.9.1
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all

# Repositories
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-40&arch=x86_64
repo --name=update --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f40&arch=x86_64

# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted --allow-ssh $y$j9T$5tgQEhl6Polt5IpaK1qfifJ3$FtgaO1qIAB/ocFDjSK0QPljLja4.3YrBbwzu3R2bA12
user --groups=wheel --name=kacper --password=$y$j9T$CPG8zWEp5anY7QGW4ijhqCQB$65puzLXRgyayl/ulcjVtwGixLqOMqZD70zEHNPZcxH0 --iscrypted --gecos="kacper"

%post --erroronfail --log=/root/ks-post.log
# Install Docker
network  --bootproto=dhcp --hostname=kacper

usermod -aG docker root
systemctl enable docker
cat << 'EOF' > /etc/systemd/system/node_deploy.service
[Unit]
Description=Download app and run container
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes

ExecStart=/usr/bin/docker pull ksagan23/node_deploy:latest
ExecStart=/usr/bin/docker run --name node ksagan23/node_deploy:latest

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable node_deploy.service
systemctl start node_deploy.service

%end
