# Generated by Anaconda 40.22.3
# Generated by pykickstart v3.52
#version=DEVEL
# Use graphical install
text

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang pl_PL.UTF-8 --addsupport=en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=enp0s3 --ipv6=auto --activate
network  --bootproto=dhcp --device=enp0s8 --ipv6=auto --activate
network  --hostname=kickstart

url --mirrorlist="http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-40&arch=x86_64"
repo --name=updates-released --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f40&arch=x86_64

%packages
@^minimal-environment
@container-management
@^server-product-environment
moby-engine
%end

# Run the Setup Agent on first boot
firstboot --enable

# Generated using Blivet version 3.9.1
ignoredisk --only-use=sda
autopart
# Partition clearing information
clearpart --all
# System timezone
timezone Europe/Warsaw --utc

# Root password
rootpw --iscrypted --allow-ssh $y$j9T$Eq3wjusz3J0m.CAUHhfLfm8q$7.7rGN2ieyZYNAYVJe9w0nJ0lzOSY2sfH5bRLvX7624
user --groups=wheel --name=benek --password=$y$j9T$1SVpZVd4dllFhohUJPLVcyJf$6ONesQIL95ug/JILtV7bMldX5QJo0mlPL2Uo5NEx825 --iscrypted --gecos="benek"

%post --erroronfail
usermod -aG docker root
systemctl enable docker

cat << 'EOF' > /etc/systemd/system/docker-java-deploy.service
[Unit]
Description=Download and run Java application container
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
ExecStart=/usr/bin/docker pull benek2002/java_deploy
ExecStart=/usr/bin/docker run -d -p 8080:8080 --name java_deploy benek2002/java_deploy

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl enable docker-java-deploy.service
systemctl start docker-java-deploy.service

%end


reboot